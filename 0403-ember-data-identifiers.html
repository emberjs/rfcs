<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>0403-ember-data-identifiers</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="introduction.html">Introduction</a></li><li class="chapter-item expanded "><a href="0001-transform-attribute-meta-parameter.html">0001-transform-attribute-meta-parameter</a></li><li class="chapter-item expanded "><a href="0003-block-params.html">0003-block-params</a></li><li class="chapter-item expanded "><a href="0003-cli-ember-doctor.html">0003-cli-ember-doctor</a></li><li class="chapter-item expanded "><a href="0010-engines.html">0010-engines</a></li><li class="chapter-item expanded "><a href="0011-improved-cp-syntax.html">0011-improved-cp-syntax</a></li><li class="chapter-item expanded "><a href="0012-help-json-output.html">0012-help-json-output</a></li><li class="chapter-item expanded "><a href="0015-the-road-to-ember-2-0.html">0015-the-road-to-ember-2-0</a></li><li class="chapter-item expanded "><a href="0020-sri-default.html">0020-sri-default</a></li><li class="chapter-item expanded "><a href="0023-command-line-completion.html">0023-command-line-completion</a></li><li class="chapter-item expanded "><a href="0024-bound-attributes.html">0024-bound-attributes</a></li><li class="chapter-item expanded "><a href="0028-app-import-output-file.html">0028-app-import-output-file</a></li><li class="chapter-item expanded "><a href="0029-addon-black-and-whitelist-for-apps.html">0029-addon-black-and-whitelist-for-apps</a></li><li class="chapter-item expanded "><a href="0045-internet-explorer.html">0045-internet-explorer</a></li><li class="chapter-item expanded "><a href="0046-cli-improved-release-process.html">0046-cli-improved-release-process</a></li><li class="chapter-item expanded "><a href="0046-registry-reform.html">0046-registry-reform</a></li><li class="chapter-item expanded "><a href="0050-cli-production-code-stripping.html">0050-cli-production-code-stripping</a></li><li class="chapter-item expanded "><a href="0050-improved-actions.html">0050-improved-actions</a></li><li class="chapter-item expanded "><a href="0053-helpers.html">0053-helpers</a></li><li class="chapter-item expanded "><a href="0055-anonymous-amd.html">0055-anonymous-amd</a></li><li class="chapter-item expanded "><a href="0056-improved-release-cycle.html">0056-improved-release-cycle</a></li><li class="chapter-item expanded "><a href="0057-ember-data-reference-unification.html">0057-ember-data-reference-unification</a></li><li class="chapter-item expanded "><a href="0058-helper-listing.html">0058-helper-listing</a></li><li class="chapter-item expanded "><a href="0061-ember-data-background-fetch.html">0061-ember-data-background-fetch</a></li><li class="chapter-item expanded "><a href="0064-contextual-component-lookup.html">0064-contextual-component-lookup</a></li><li class="chapter-item expanded "><a href="0065-deprecation-warning-handlers.html">0065-deprecation-warning-handlers</a></li><li class="chapter-item expanded "><a href="0080-serve-file-api.html">0080-serve-file-api</a></li><li class="chapter-item expanded "><a href="0086-firefox-in-ci.html">0086-firefox-in-ci</a></li><li class="chapter-item expanded "><a href="0090-addon-tree-caching.html">0090-addon-tree-caching</a></li><li class="chapter-item expanded "><a href="0091-cli-addon-instrumentation-experimental-hooks.html">0091-cli-addon-instrumentation-experimental-hooks</a></li><li class="chapter-item expanded "><a href="0091-weakmap.html">0091-weakmap</a></li><li class="chapter-item expanded "><a href="0092-blueprint-remove-old-files.html">0092-blueprint-remove-old-files</a></li><li class="chapter-item expanded "><a href="0095-cli-standardise-targets.html">0095-cli-standardise-targets</a></li><li class="chapter-item expanded "><a href="0095-router-service.html">0095-router-service</a></li><li class="chapter-item expanded "><a href="0096-enable-yarn-usage.html">0096-enable-yarn-usage</a></li><li class="chapter-item expanded "><a href="0101-ember-data-friendly-errors.html">0101-ember-data-friendly-errors</a></li><li class="chapter-item expanded "><a href="0105-addons-optionalDependencies.html">0105-addons-optionalDependencies</a></li><li class="chapter-item expanded "><a href="0108-add-custom-transform.html">0108-add-custom-transform</a></li><li class="chapter-item expanded "><a href="0110-packaging.html">0110-packaging</a></li><li class="chapter-item expanded "><a href="0114-add-template-lint-addon.html">0114-add-template-lint-addon</a></li><li class="chapter-item expanded "><a href="0116-qunit-dom.html">0116-qunit-dom</a></li><li class="chapter-item expanded "><a href="0120-cli-guides.html">0120-cli-guides</a></li><li class="chapter-item expanded "><a href="0120-route-serializers.html">0120-route-serializers</a></li><li class="chapter-item expanded "><a href="0121-remove-ember-cli-eslint.html">0121-remove-ember-cli-eslint</a></li><li class="chapter-item expanded "><a href="0136-contains-to-includes.html">0136-contains-to-includes</a></li><li class="chapter-item expanded "><a href="0139-isHtmlSafe.html">0139-isHtmlSafe</a></li><li class="chapter-item expanded "><a href="0143-module-unification.html">0143-module-unification</a></li><li class="chapter-item expanded "><a href="0150-factory-for.html">0150-factory-for</a></li><li class="chapter-item expanded "><a href="0176-javascript-module-api.html">0176-javascript-module-api</a></li><li class="chapter-item expanded "><a href="0178-deprecate-ember-k.html">0178-deprecate-ember-k</a></li><li class="chapter-item expanded "><a href="0181-deprecate-ember-data-initializers.html">0181-deprecate-ember-data-initializers</a></li><li class="chapter-item expanded "><a href="0186-track-unique-history-location-state.html">0186-track-unique-history-location-state</a></li><li class="chapter-item expanded "><a href="0191-deprecate-component-lifecycle-hook-args.html">0191-deprecate-component-lifecycle-hook-args</a></li><li class="chapter-item expanded "><a href="0194-deprecate-custom-event-manager.html">0194-deprecate-custom-event-manager</a></li><li class="chapter-item expanded "><a href="0213-custom-components.html">0213-custom-components</a></li><li class="chapter-item expanded "><a href="0225-ember-engines-mount-params.html">0225-ember-engines-mount-params</a></li><li class="chapter-item expanded "><a href="0226-named-blocks.html">0226-named-blocks</a></li><li class="chapter-item expanded "><a href="0229-deprecate-testing-restricted-resolver.html">0229-deprecate-testing-restricted-resolver</a></li><li class="chapter-item expanded "><a href="0232-simplify-qunit-testing-api.html">0232-simplify-qunit-testing-api</a></li><li class="chapter-item expanded "><a href="0236-deprecation-ember-string.html">0236-deprecation-ember-string</a></li><li class="chapter-item expanded "><a href="0237-deprecation-ember-map.html">0237-deprecation-ember-map</a></li><li class="chapter-item expanded "><a href="0240-es-classes.html">0240-es-classes</a></li><li class="chapter-item expanded "><a href="0252-browser-support-changes.html">0252-browser-support-changes</a></li><li class="chapter-item expanded "><a href="0268-acceptance-testing-refactor.html">0268-acceptance-testing-refactor</a></li><li class="chapter-item expanded "><a href="0272-deprecation-native-function-prototype-extensions.html">0272-deprecation-native-function-prototype-extensions</a></li><li class="chapter-item expanded "><a href="0276-named-args.html">0276-named-args</a></li><li class="chapter-item expanded "><a href="0278-template-only-components.html">0278-template-only-components</a></li><li class="chapter-item expanded "><a href="0280-remove-application-wrapper.html">0280-remove-application-wrapper</a></li><li class="chapter-item expanded "><a href="0281-es5-getters.html">0281-es5-getters</a></li><li class="chapter-item expanded "><a href="0286-block-let-template-helper.html">0286-block-let-template-helper</a></li><li class="chapter-item expanded "><a href="0287-promote-in-element-to-public-api.html">0287-promote-in-element-to-public-api</a></li><li class="chapter-item expanded "><a href="0293-record-data.html">0293-record-data</a></li><li class="chapter-item expanded "><a href="0294-optional-jquery.html">0294-optional-jquery</a></li><li class="chapter-item expanded "><a href="0297-deprecate-ember-logger.html">0297-deprecate-ember-logger</a></li><li class="chapter-item expanded "><a href="0300-rfc-process-update.html">0300-rfc-process-update</a></li><li class="chapter-item expanded "><a href="0308-deprecate-property-lookup-fallback.html">0308-deprecate-property-lookup-fallback</a></li><li class="chapter-item expanded "><a href="0311-angle-bracket-invocation.html">0311-angle-bracket-invocation</a></li><li class="chapter-item expanded "><a href="0318-array-helper.html">0318-array-helper</a></li><li class="chapter-item expanded "><a href="0322-deprecate-copy-copyable.html">0322-deprecate-copy-copyable</a></li><li class="chapter-item expanded "><a href="0324-deprecate-component-isvisible.html">0324-deprecate-component-isvisible</a></li><li class="chapter-item expanded "><a href="0326-ember-data-filter-deprecation.html">0326-ember-data-filter-deprecation</a></li><li class="chapter-item expanded "><a href="0329-deprecated-ember-evented-in-ember-data.html">0329-deprecated-ember-evented-in-ember-data</a></li><li class="chapter-item expanded "><a href="0331-deprecate-globals-resolver.html">0331-deprecate-globals-resolver</a></li><li class="chapter-item expanded "><a href="0332-ember-data-record-links-and-meta.html">0332-ember-data-record-links-and-meta</a></li><li class="chapter-item expanded "><a href="0335-deprecate-send-action.html">0335-deprecate-send-action</a></li><li class="chapter-item expanded "><a href="0337-native-class-constructor-update.html">0337-native-class-constructor-update</a></li><li class="chapter-item expanded "><a href="0340-deprecate-ember-merge.html">0340-deprecate-ember-merge</a></li><li class="chapter-item expanded "><a href="0345-discord.html">0345-discord</a></li><li class="chapter-item expanded "><a href="0364-roadmap-2018.html">0364-roadmap-2018</a></li><li class="chapter-item expanded "><a href="0369-deprecate-computed-clobberability.html">0369-deprecate-computed-clobberability</a></li><li class="chapter-item expanded "><a href="0370-deprecate-computed-volatile.html">0370-deprecate-computed-volatile</a></li><li class="chapter-item expanded "><a href="0372-ember-data-model-factory-for.html">0372-ember-data-model-factory-for</a></li><li class="chapter-item expanded "><a href="0373-Element-Modifier-Managers.html">0373-Element-Modifier-Managers</a></li><li class="chapter-item expanded "><a href="0375-deprecate-computed-property-modifier.html">0375-deprecate-computed-property-modifier</a></li><li class="chapter-item expanded "><a href="0386-remove-jquery.html">0386-remove-jquery</a></li><li class="chapter-item expanded "><a href="0389-dynamic-tag-names.html">0389-dynamic-tag-names</a></li><li class="chapter-item expanded "><a href="0391-router-helpers.html">0391-router-helpers</a></li><li class="chapter-item expanded "><a href="0392-deprecate-component-manager-string-lookup.html">0392-deprecate-component-manager-string-lookup</a></li><li class="chapter-item expanded "><a href="0395-ember-data-packages.html">0395-ember-data-packages</a></li><li class="chapter-item expanded "><a href="0398-RouteInfo-Metadata.html">0398-RouteInfo-Metadata</a></li><li class="chapter-item expanded "><a href="0403-ember-data-identifiers.html" class="active">0403-ember-data-identifiers</a></li><li class="chapter-item expanded "><a href="0408-decorators.html">0408-decorators</a></li><li class="chapter-item expanded "><a href="0410-tracked-properties.html">0410-tracked-properties</a></li><li class="chapter-item expanded "><a href="0415-render-element-modifiers.html">0415-render-element-modifiers</a></li><li class="chapter-item expanded "><a href="0416-glimmer-components.html">0416-glimmer-components</a></li><li class="chapter-item expanded "><a href="0418-deprecate-route-render-methods.html">0418-deprecate-route-render-methods</a></li><li class="chapter-item expanded "><a href="0421-deprecate-application-controller-props.html">0421-deprecate-application-controller-props</a></li><li class="chapter-item expanded "><a href="0425-website-redesign.html">0425-website-redesign</a></li><li class="chapter-item expanded "><a href="0431-guides-restructure.html">0431-guides-restructure</a></li><li class="chapter-item expanded "><a href="0432-contextual-helpers.html">0432-contextual-helpers</a></li><li class="chapter-item expanded "><a href="0435-modifier-splattributes.html">0435-modifier-splattributes</a></li><li class="chapter-item expanded "><a href="0440-decorator-support.html">0440-decorator-support</a></li><li class="chapter-item expanded "><a href="0445-deprecate-with.html">0445-deprecate-with</a></li><li class="chapter-item expanded "><a href="0446-contribution-guides.html">0446-contribution-guides</a></li><li class="chapter-item expanded "><a href="0449-deprecate-partials.html">0449-deprecate-partials</a></li><li class="chapter-item expanded "><a href="0451-injection-parameter-normalization.html">0451-injection-parameter-normalization</a></li><li class="chapter-item expanded "><a href="0452-ember-data-medium-term-plan.html">0452-ember-data-medium-term-plan</a></li><li class="chapter-item expanded "><a href="0457-nested-lookups.html">0457-nested-lookups</a></li><li class="chapter-item expanded "><a href="0459-angle-bracket-built-in-components.html">0459-angle-bracket-built-in-components</a></li><li class="chapter-item expanded "><a href="0460-yieldable-named-blocks.html">0460-yieldable-named-blocks</a></li><li class="chapter-item expanded "><a href="0461-ember-data-singleton-record-data.html">0461-ember-data-singleton-record-data</a></li><li class="chapter-item expanded "><a href="0463-record-data-state.html">0463-record-data-state</a></li><li class="chapter-item expanded "><a href="0465-record-data-errors.html">0465-record-data-errors</a></li><li class="chapter-item expanded "><a href="0466-request-state-service.html">0466-request-state-service</a></li><li class="chapter-item expanded "><a href="0468-classic-decorator.html">0468-classic-decorator</a></li><li class="chapter-item expanded "><a href="0470-fn-helper.html">0470-fn-helper</a></li><li class="chapter-item expanded "><a href="0471-on-modifier.html">0471-on-modifier</a></li><li class="chapter-item expanded "><a href="0477-blueprints-update.html">0477-blueprints-update</a></li><li class="chapter-item expanded "><a href="0478-tracked-properties-updates.html">0478-tracked-properties-updates</a></li><li class="chapter-item expanded "><a href="0481-component-templates-co-location.html">0481-component-templates-co-location</a></li><li class="chapter-item expanded "><a href="0486-deprecate-mouseenter.html">0486-deprecate-mouseenter</a></li><li class="chapter-item expanded "><a href="0487-custom-model-classes.html">0487-custom-model-classes</a></li><li class="chapter-item expanded "><a href="0491-deprecate-disconnect-outlet.html">0491-deprecate-disconnect-outlet</a></li><li class="chapter-item expanded "><a href="0494-async-observers.html">0494-async-observers</a></li><li class="chapter-item expanded "><a href="0496-handlebars-strict-mode.html">0496-handlebars-strict-mode</a></li><li class="chapter-item expanded "><a href="0507-embroider-v2-package-format.html">0507-embroider-v2-package-format</a></li><li class="chapter-item expanded "><a href="0519-2019-2020-roadmap.html">0519-2019-2020-roadmap</a></li><li class="chapter-item expanded "><a href="0521-find-by-identifier.html">0521-find-by-identifier</a></li><li class="chapter-item expanded "><a href="0522-default-serializers-and-adapters.html">0522-default-serializers-and-adapters</a></li><li class="chapter-item expanded "><a href="0523-model-argument-for-route-templates.html">0523-model-argument-for-route-templates</a></li><li class="chapter-item expanded "><a href="0554-deprecate-getwithdefault.html">0554-deprecate-getwithdefault</a></li><li class="chapter-item expanded "><a href="0558-edition-detection.html">0558-edition-detection</a></li><li class="chapter-item expanded "><a href="0560-add-equality-operators.html">0560-add-equality-operators</a></li><li class="chapter-item expanded "><a href="0561-add-numeric-comparison-operators.html">0561-add-numeric-comparison-operators</a></li><li class="chapter-item expanded "><a href="0562-add-logical-operators.html">0562-add-logical-operators</a></li><li class="chapter-item expanded "><a href="0566-memo-decorator.html">0566-memo-decorator</a></li><li class="chapter-item expanded "><a href="0580-destroyables.html">0580-destroyables</a></li><li class="chapter-item expanded "><a href="0581-new-test-waiters.html">0581-new-test-waiters</a></li><li class="chapter-item expanded "><a href="0585-improved-ember-registry-apis.html">0585-improved-ember-registry-apis</a></li><li class="chapter-item expanded "><a href="0615-autotracking-memoization.html">0615-autotracking-memoization</a></li><li class="chapter-item expanded "><a href="0617-rfc-stages.html">0617-rfc-stages</a></li><li class="chapter-item expanded "><a href="0625-helper-managers.html">0625-helper-managers</a></li><li class="chapter-item expanded "><a href="0626-invoke-helper.html">0626-invoke-helper</a></li><li class="chapter-item expanded "><a href="0628-prettier.html">0628-prettier</a></li><li class="chapter-item expanded "><a href="0631-refresh-method-for-router-service.html">0631-refresh-method-for-router-service</a></li><li class="chapter-item expanded "><a href="0635-ember-new-lang.html">0635-ember-new-lang</a></li><li class="chapter-item expanded "><a href="0637-customizable-test-setups.html">0637-customizable-test-setups</a></li><li class="chapter-item expanded "><a href="0638-interactive-app-creation.html">0638-interactive-app-creation</a></li><li class="chapter-item expanded "><a href="0639-replace-blacklist-whitelist.html">0639-replace-blacklist-whitelist</a></li><li class="chapter-item expanded "><a href="0645-add-ember-page-title-addon.html">0645-add-ember-page-title-addon</a></li><li class="chapter-item expanded "><a href="0649-deprecation-staging.html">0649-deprecation-staging</a></li><li class="chapter-item expanded "><a href="0659-unique-id-helper.html">0659-unique-id-helper</a></li><li class="chapter-item expanded "><a href="0669-tracked-storage-primitive.html">0669-tracked-storage-primitive</a></li><li class="chapter-item expanded "><a href="0671-modernize-built-in-components-1.html">0671-modernize-built-in-components-1</a></li><li class="chapter-item expanded "><a href="0673-deprecate-tryinvoke.html">0673-deprecate-tryinvoke</a></li><li class="chapter-item expanded "><a href="0674-deprecate-transition-methods-of-controller-and-route.html">0674-deprecate-transition-methods-of-controller-and-route</a></li><li class="chapter-item expanded "><a href="0680-implicit-injection-deprecation.html">0680-implicit-injection-deprecation</a></li><li class="chapter-item expanded "><a href="0685-new-browser-support-policy.html">0685-new-browser-support-policy</a></li><li class="chapter-item expanded "><a href="0686-deprecate-old-manager-capabilities-versions.html">0686-deprecate-old-manager-capabilities-versions</a></li><li class="chapter-item expanded "><a href="0689-deprecate-has-block.html">0689-deprecate-has-block</a></li><li class="chapter-item expanded "><a href="0690-deprecate-attrs-in-templates.html">0690-deprecate-attrs-in-templates</a></li><li class="chapter-item expanded "><a href="0691-deprecate-class-binding-and-class-name-bindings.html">0691-deprecate-class-binding-and-class-name-bindings</a></li><li class="chapter-item expanded "><a href="0692-deprecate-array-observers.html">0692-deprecate-array-observers</a></li><li class="chapter-item expanded "><a href="0698-deprecate-link-to-positional-arguments.html">0698-deprecate-link-to-positional-arguments</a></li><li class="chapter-item expanded "><a href="0702-eslint-plugin-qunit.html">0702-eslint-plugin-qunit</a></li><li class="chapter-item expanded "><a href="0704-deprecate-octane-optional-features.html">0704-deprecate-octane-optional-features</a></li><li class="chapter-item expanded "><a href="0705-deprecate-jquery-optional-feature.html">0705-deprecate-jquery-optional-feature</a></li><li class="chapter-item expanded "><a href="0706-deprecate-ember-global.html">0706-deprecate-ember-global</a></li><li class="chapter-item expanded "><a href="0707-modernize-built-in-components-2.html">0707-modernize-built-in-components-2</a></li><li class="chapter-item expanded "><a href="0711-deprecate-auto-location.html">0711-deprecate-auto-location</a></li><li class="chapter-item expanded "><a href="0724-road-to-typescript.html">0724-road-to-typescript</a></li><li class="chapter-item expanded "><a href="0738-ember-data-deprecate-model-reopen.html">0738-ember-data-deprecate-model-reopen</a></li><li class="chapter-item expanded "><a href="0750-deprecate-ember-assign.html">0750-deprecate-ember-assign</a></li><li class="chapter-item expanded "><a href="0752-inject-service.html">0752-inject-service</a></li><li class="chapter-item expanded "><a href="0756-helper-default-manager.html">0756-helper-default-manager</a></li><li class="chapter-item expanded "><a href="0772-deprecate-bower-support.html">0772-deprecate-bower-support</a></li><li class="chapter-item expanded "><a href="0776-typescript-blueprints.html">0776-typescript-blueprints</a></li><li class="chapter-item expanded "><a href="0779-first-class-component-templates.html">0779-first-class-component-templates</a></li><li class="chapter-item expanded "><a href="0786-ember-cookbook.html">0786-ember-cookbook</a></li><li class="chapter-item expanded "><a href="0794-ember-data-schema-definition-service-simplify.html">0794-ember-data-schema-definition-service-simplify</a></li><li class="chapter-item expanded "><a href="0795-ember-data-return-promise-save.html">0795-ember-data-return-promise-save</a></li><li class="chapter-item expanded "><a href="0801-deprecate-blacklist-and-whitelist-build-options.html">0801-deprecate-blacklist-and-whitelist-build-options</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <hr />
<p>Start Date: 2018-11-25
Relevant Team(s): Ember Data
RFC PR: https://github.com/emberjs/rfcs/pull/403
Tracking: https://github.com/emberjs/rfc-tracking/issues/31</p>
<hr />
<h1 id="ember-data--identifiers"><a class="header" href="#ember-data--identifiers">Ember Data | Identifiers</a></h1>
<h2 id="summary"><a class="header" href="#summary">Summary</a></h2>
<p><code>Identifiers</code> provides infrastructure for handling <code>identity</code> within <code>ember-data</code> to
satisfy requirements around improved caching, serializability, replication, and handling
of remote data.</p>
<p>This concept would parallel a similar structure proposed for <code>json-api</code> resource identifier
<code>lid</code> property <a href="https://github.com/json-api/json-api/pull/1244">drafted for version <code>1.2</code> of the <code>json-api</code> spec</a>.</p>
<p>In doing so we provide a framework for future RFCs and/or addons to address many common
feature requests.</p>
<hr />
<h2 id="motivation"><a class="header" href="#motivation">Motivation</a></h2>
<p>This groundwork RFC represents the union of a diverse set of motivations, each of which 
is discussed below in no particular order of importance, outside of the first. <strong>This 
RFC is not seeking to immediately address each of the motivations below, we are adding
infrastructure to make future RFCs possible in these spaces</strong></p>
<h3 id="unified-concept-of-identity"><a class="header" href="#unified-concept-of-identity">Unified concept of Identity</a></h3>
<p>Identity is a core concept to managing a cache and guaranteeing <a href="https://en.wikipedia.org/wiki/ACID_(computer_science)">atomicity, consistency,
isolation, and durability</a>. 
Currently, <code>ember-data</code> has no unified mechanism for Identity. This missing mechanism 
introduces errors in application code, makes <code>ember-data</code> internals needlessly complex, 
and complicates the method signatures of many public APIs.</p>
<p>Creating a unified <code>Identity</code> concept will allow <code>ember-data</code> to expose <code>identity</code> as a 
first-class primitive to our users, improving the mental model, improving application 
resiliance to errors, and providing a clear language of communication between <code>ember-data</code>'s 
various primitives.</p>
<p>Today, we handle <code>identity</code> in a myriad of ad-hoc ways:</p>
<ul>
<li><code>InternalModel</code> instances as keys for most internal methods and the relationship layer.</li>
<li><code>type+id</code> for serializing/deserializing a <code>record</code> or <a href="https://jsonapi.org/format/#document-resource-object-identification"><code>resource</code></a></li>
<li><code>type+clientId</code> for caching newly created records on the client and communicating 
about them with <code>RecordData</code>.</li>
<li>Various other non-serializable forms of identity for tracking requests, relationship 
membership and state.</li>
<li>In some cases we have no concept at all where one is needed (for instance, caching 
queries)</li>
</ul>
<p>We wish to simplify and codify our handling of identity.</p>
<h3 id="simplify-storewrapper-and-recorddata-apis"><a class="header" href="#simplify-storewrapper-and-recorddata-apis">Simplify StoreWrapper and RecordData APIs</a></h3>
<p>Today, to deal with the lack of a unified <code>identifier</code> concept, we overload many 
<code>StoreWrapper</code> and <code>RecordData</code> API method signatures with <code>modelName</code>, <code>id</code>, <code>clientId</code>
as arguments. This leads to method signatures being long and needlessly unwieldy.</p>
<p>Note: We had initially intended to overload all of these classes method signatures in 
this way, to ensure that <code>RecordData</code> implementations could be <code>singleton</code>s, but we failed
to correctly implement the <code>RecordData</code> RFC in this regard and a near future RFC will look
at rectifying this using the <code>Identity</code> APIs introduced here.</p>
<p>Moving to a unified concept of <code>identity</code> opens up a path to clean up these method
signatures.</p>
<h3 id="operations"><a class="header" href="#operations">Operations</a></h3>
<p>Operations are a foundational concept for <code>acid</code> transactions. Without the ability to 
describe an operation and a clear mental model of what operations exist and achieve, it
is difficult to understand how an action affects state. Granularity and clarity is key.</p>
<p>While <code>ember-data</code> does not yet have concepts of operations or transactions, mutations and
updates are applied directly, there are many areas we could improve upon by introducing
them. As with data, operations upon data should be serializable so that local state can 
be accurately cached on local clients.</p>
<h3 id="nested-saves--api-transactions--websocket-support"><a class="header" href="#nested-saves--api-transactions--websocket-support">Nested Saves / API Transactions / Websocket Support</a></h3>
<p>Many applications wish to create or update and save multiple records together. Achieving
this in <code>ember-data</code> today is unweildy and has many difficult edge cases: one of which
is correctly matching data received back from the API to the newly created records already
on the client.</p>
<p>A similar edge case occurs when a newly created record is saved for the first time and 
prior to receiving the request response the same record is recieved via another means
(background polling, websocket subscription, etc.). We have no means of matching the record
returned by the alternative means to that of the request, leading to a second cache entry 
being created and an error once the initial request completes.</p>
<p>One solution has been to generate and assign <code>id</code>s for records on the client, but this is
not always desireable. These scenarios are a major motivation for <code>lid</code> in the <code>json-api</code>
spec. Users wishing to solve these cases would be able to serialize the <code>lid</code> of the 
<code>Identifier</code> for a newly created record and reflect that <code>lid</code> back in any payloads send 
from their API for the session to correctly match the payloads to the record.</p>
<h3 id="better-cache-serialization--improved-infra-for-offline-support"><a class="header" href="#better-cache-serialization--improved-infra-for-offline-support">Better Cache Serialization &amp; Improved Infra for Offline Support</a></h3>
<p>In order to enable users to achieve full offline support, or to serialize the store 
or transport across the wire (for example as an advanced fastboot rehydration mode)
the entire state of the store needs to be serializable. This RFC introduces the 
foundation for mechanisms through which this can be later achieved.</p>
<hr />
<h2 id="detailed-design"><a class="header" href="#detailed-design">Detailed design</a></h2>
<pre><code class="language-typescript">export interface Identifier {
  lid: string;
}

export interface RecordIdentifier extends Identifier {
  id?: string | null;
  type: string;
}
</code></pre>
<p>Note: the referential stability (object reference) of all identifiers created by the
<code>store</code> is guaranteed. E.g. any data that results in the lookup of an identifier 
producing the same <code>lid</code> token will return the same <code>Identifier</code> instance. This is 
useful for being able to use identifiers for either <code>Map</code> or <code>WeakMap</code> cache solutions.</p>
<h3 id="buckets"><a class="header" href="#buckets">Buckets</a></h3>
<p>In an ideal world, the <code>lid</code> of each <code>Identifier</code> would be a <code>v4</code> <a href="https://en.wikipedia.org/wiki/Universally_unique_identifier">uuid</a>,
making it practically unique in all contexts. However, due to requirements around design
flexibility and performance we are only requiring that <code>Identifiers</code> be unique <em>within 
their bucket</em> for the data they are intended to reference.</p>
<p>Each underlying primitive will have its own bucket, as new primitives are formalized, new
buckets will emerge. Initially we expect only a <code>record</code> bucket which aligns with today's
<code>IdentityMap</code> cache for <code>Record</code>s. Examples of future buckets may include a cache for 
<code>queries</code>, <code>documents</code>, <code>transactions</code>, <code>operations</code>, <code>errors</code>, <code>meta</code> or any number of other
concepts that represent state required to be serializable.</p>
<p>In our ideal world, the <code>lid</code> would then be a <code>uuid-v4</code> that is practically unique across
buckets and not just within. While we  will ship a minimal <code>uuid-v4</code> generator to be used
for generating identifiers when needed on the client, generating large quantities of <code>uuid</code>s
is cost prohibitive.  An early performance analysis suggests that a few thousand identifiers
would bring a cost in the tens of milliseconds on powerful machines. When generating
identifiers for data returned by an API, this cost would impede optimizations around
rendering.</p>
<p>This cost is primarily due to the need to generate large quantities of random bytes: a cost
that is necessarily cpu intensive. Additionally, many forms of data (such as <code>json-api</code> 
resources) come with unique or nearly unique identifying information already (<code>type</code> + <code>id</code>,
<code>href</code> etc.).  Some APIs already make use of <code>v4</code> <code>uuid</code>s as IDs, and for these APIs it would
make the most sense to implement a custom generation method to reuise these <code>id</code>s as <code>lid</code>s
when present.</p>
<p>To balance performance with the requirements of <code>identity</code>, we are choosing what we feel is a
<em>sensible default</em>.  Users for whom this default does not meet their requirements may override
the appropriate hooks to generate identifiers that do.</p>
<h3 id="customizing-identifiers"><a class="header" href="#customizing-identifiers">Customizing Identifiers</a></h3>
<p>For users wishing to provide increased guarantees around uniqueness and serializability
of identifiers we provide the ability to configure how we generate and manage identifiers.</p>
<p>Given the guarantees around uniqueness and serializability that are required, this configuration
applies to all <code>IdentifierCache</code> instances and meaning that it is shared across all buckets,
store instances. Ideally the configuration does not change between application instances but
for encapsulation purposes for fastboot and tests we allow and encourage repeated setup/teardown.
Specifically, this recommendation is that in order to provide a strong guarantee of uniqueness
and serializability, <em>identifiers generated by separate store or application instances but which
represent the same data should result in the generation of the same <code>lid</code></em>.</p>
<p>Indeed in this vein, we have not provided a mechanism for distinguishing what instance of a <code>store</code>
has asked for an <code>Identifier</code> when multiple stores are present, but the <code>initializer</code> pattern
recommended below does offer the ability to distinguish <em>per-application</em>. We do not recommend
using this availability to affect your generation method.</p>
<p>Supplying custom <code>lid</code> generation can be done using <code>setIdentifierGenerationMethod</code>. Currently
there is only one bucket (<code>record</code>) as discussed above, but we reserve the ability to add 
additional buckets in the future.</p>
<p>Users should do any identifier customization within an instance-initialize prior to making use
of the store. Given the more universal nature of this customization, we recommend ensuring that
you consider the mechanics of multiple applications in fastboot or test application instance
scenarios when instantiating and populating any secondary lookup tables or caches for identifiers.
Weakmapping these lookup tables and caches to the application instance will accomplish this.
An example is provided below.</p>
<pre><code class="language-typescript">/*
  A method which can expect to receive various data as its first argument
  and the name of a bucket as its second argument. Currently the second
  argument will always be `record` data should conform to a `json-api`
  `Resource` interface, but will be the normalized json data for a single
  resource that has been given to the store.

  The method must return a unique (to at-least the given bucket) string identifier
  for the given data as a string to be used as the `lid` of an `Identifier` token.

  This method will only be called by either `getOrCreateIdentifier` or 
  `createIdentifierForNewRecord` when an identifier for the supplied data
  is not already known via `lid` or `type + id` combo and one needs to be
  generated or retrieved from a proprietary cache.

  `data` will be the same data argument provided to `getOrCreateIdentifier`
  and in the `createIdentifierForNewRecord` case will be an object with
  only `type` as a key.
*/
type GenerationMethod = (data: Object, bucket: string) =&gt; string;

/*
 A method which can expect to receive an existing `Identifier` alongside
 some new data to consider as a second argument. This is an opportunity
 for secondary lookup tables and caches associated with the identifier
 to be amended.

 This method is called everytime `updateRecordIdentifier` is called and
  with the same arguments. It provides the opportunity to update secondary
  lookup tables for existing identifiers.
  
 It will always be called after an identifier created with `createIdentifierForNewRecord`
  has been committed, or after an update to the `record` a `RecordIdentifier`
  is assigned to has been committed. Committed here meaning that the server
  has acknowledged the update (for instance after a call to `.save()`)

 If `id` has not previously existed, it will be assigned to the `Identifier`
  prior to this `UpdateMethod` being called; however, calls to the parent method
  `updateRecordIdentifier` that attempt to change the `id` or calling update
  without providing an `id` when one is missing will throw an error.
*/
type UpdateMethod = (identifier: StableIdentifier, newData: Object, bucket: string) =&gt; void;

/*
A method which can expect to receive an existing `Identifier` that should be eliminated
 from any secondary lookup tables or caches that the user has populated for it.
*/
type ForgetMethod = (identifier: StableIdentifier) =&gt; void;

/*
 A method which can expect to be called when the parent application is destroyed.

 If you have properly used a WeakMap to encapsulate the state of your customization
 to the application instance, you may not need to implement the `resetMethod`.
*/
type ResetMethod = () =&gt; void;

export function setIdentifierGenerationMethod(method: GenerationMethod): void {}

export function setIdentifierUpdateMethod(method: UpdateMethod): void {}

export function setIdentifierForgetMethod(method: ForgetMethod): void {}

export function setIdentifierResetMethod(method: ResetMethod): void {}
</code></pre>
<p>A simple custom generation method might be an increasing counter like below:</p>
<pre><code class="language-typescript">import { setIdentifierGenerationMethod } form '@ember-data/store';

export function initialize(applicationInstance) {
  // note how `count` here is now scoped to the application instance
  // for our generation method by being inside the closure provided
  // by the initialize function
  let count = 0;

  setIdentifierGenerationMethod((resource: Resource) =&gt; {
    return resource.lid || `my-key-${count++}`;
  });
}

export default {
  name: 'configure-ember-data-identifiers',
  initialize
};
</code></pre>
<h3 id="identifiers-for-records"><a class="header" href="#identifiers-for-records">Identifiers for Records</a></h3>
<p>When discussing identifiers for records it is useful to be familiar with <code>json-api</code> 
interfaces for <a href="https://jsonapi.org/format/#document-resource-objects">ResourceObjects</a> 
and <a href="https://jsonapi.org/format/#document-resource-identifier-objects">ResourceIdentifierObjects</a>.</p>
<p>Below, we expose a rough approximation of these interfaces as <code>Resource</code> including the
potential presence of <code>lid</code>.</p>
<pre><code class="language-typescript">import { Value as JSONValue } from 'json-typescript';

type JSONDict = { [k: string]: JSONValue };

export interface Resource {
  id: string;
  type: string;
  lid?: string;
  attributes?: JSONDict;
  relationships?: JSONDict;
  meta?: JSONDict;
}
</code></pre>
<p>We can access and generate identifiers for records using the following APIs available
via the <code>identifierCache</code> on the <code>Store</code> and <code>StoreWrapper</code> classes.</p>
<pre><code class="language-typescript">import Service from '@ember/service';

export interface Store {
  identifierCache: IdentifierCache
}

export interface StoreWrapper {
  identifierCache: IdentifierCache
}

export default class IdentifierCache extends Service {
  /*
   Returns the Identifier for the given Resource, creates one if it does not yet exist.

   Specifically this means that we:

   - validate the `id` `type` and `lid` combo against known identifiers
   - return an object with an `lid` that is stable (repeated calls with the same
    `id` + `type` or `lid` will return the same `lid` value)
   - this referential stability of the object itself is guaranteed
  */
  getOrCreateRecordIdentifier(resource: Resource): RecordIdentifier {}

  /*
   Returns a new Identifier for the supplied data. Call this method to generate
   an identifier when  a new resource is being created local to the client and
   potentially does not have an `id`.
  */
  createIdentifierForNewRecord({ type: string, id: string | null }): RecordIdentifier {}

  /*
   Provides the opportunity to update secondary lookup tables for existing identifiers
   
   Called with the attributes provided to createRecord after an identifier created with
   `createIdentifierForNewRecord` has been instantiated.

   Called again after an identifier created with `createIdentifierForNewRecord` has been
   committed, or a resource has received an update from the API.

   Assigns `id` to an `Identifier` if `id` has not previously existed; however,
   attempting to change the `id` or calling update without providing an `id` when
   one is missing will throw an error.
  */
  updateRecordIdentifier(identifier: RecordIdentifier, data: Resource): void;

  /*
   Provides the opportunity to eliminate an identifier from secondary lookup tables
   as well as eliminates it from ember-data's own lookup tables and book keeping.

   Useful when a record has been deleted and the deletion has been persisted and
   we do not care about the record anymore. Especially useful when an `id` of a
   deleted record might be reused later for a new record.
  */
  forgetRecordIdentifier(identifier: RecordIdentifier): void
}

// -- example uses

// ... for existing resources
let identifierA = identifierCache.getOrCreateRecordIdentifier({
  type: 'foo',
  id: '1'
}); // =&gt; { lid: 'some-unique-key-1324' }
let identifierB = identifierCache.getOrCreateRecordIdentifier({
  type: 'foo',
  id: '2',
  lid: '123a' 
}); // =&gt; { lid: '123a' }
let identifierC = identifierCache.getOrCreateRecordIdentifier({ 
  type: 'foo', 
  lid: '123b' 
}); // =&gt; { lid: '123b' }
let identifierD = identifierCache.getOrCreateRecordIdentifier({ 
  lid: '123c' 
}); // =&gt; { lid: '123c' }

// ... generating identifiers for newly created resources
// (this is something that likely only store.createRecord() should do)
let identifier1 = identifierCache.createIdentifierForNewRecord('foo'); // =&gt; { lid: 'some-random-unique-key-123a' }
let identifier2 = identifierCache.createIdentifierForNewRecord('foo'); // =&gt; { lid: 'some-random-unique-key-123b' }
let identifier3 = identifierCache.createIdentifierForNewRecord('bar'); // =&gt; { lid: 'some-random-unique-key-123c' }
</code></pre>
<h3 id="updating-new-record-identifiers-with-more-complete-information"><a class="header" href="#updating-new-record-identifiers-with-more-complete-information">Updating new record Identifiers with more complete information</a></h3>
<p>Called when an identifier has been generated for resource data prior to <code>id</code> being
available for that resource and complete resource data is now available. <code>ember-data</code> 
will automatically call this with the resolved payload after save for any newly created
records. An <code>identifier</code> can only be updated once, and only when transitioning the 
associated resource from a never-before-persisted to persisted state.</p>
<p>Udating provides the opportunity to update the primary and secondary lookup tables for the
identifier. In the case of a RecordIdentifier that was created locally, it provides the
ability to do a &quot;one time only&quot; upgrade of the identifier to assign an id.</p>
<pre><code class="language-ts">IdentifierCache {
  updateRecordIdentifier(identifier: RecordIdentifier, data: Resource): void;
}
</code></pre>
<h3 id="refreshing-an-identifier-when-recycling-an-id"><a class="header" href="#refreshing-an-identifier-when-recycling-an-id">Refreshing an <code>Identifier</code> When recycling an <code>id</code></a></h3>
<p>Occasionally some APIs re-use the same <code>id</code> for different <code>data</code>. Common scenarios for
this include reusing the <code>id</code> of a previously deleted record for a new record, and less
commonly a stable <code>id</code> to reference the &quot;currently logged in user&quot;.</p>
<p>When this occurs, the existing <code>lid</code> needs the chance to be forgotten and a new <code>lid</code>
generated. This method eliminates the identifier from our internal cache only. Caches
associated with custom identifiier generation methods must be cleared by the implementors
of those custom methods. Any data associated with the original <code>lid</code> should be purged from
caches prior to calling this method. We leave it to follow up RFCs to provide
infrastructure for safely and correctly eliminating records from caches.</p>
<pre><code class="language-ts">IdentifierCache {
  forgetRecordIdentifier(identifier: RecordIdentifier): void
}
</code></pre>
<h3 id="access-from-record-instances"><a class="header" href="#access-from-record-instances">Access from <code>record</code> instances</a></h3>
<pre><code class="language-typescript">export function recordIdentifierFor(record: object): RecordIdentifier {}
</code></pre>
<pre><code class="language-ts">import { recordIdentifierFor } from '@ember-data/store';

// ...

// when you have a record instance
let identifier = recordIdentifierFor(record);

// from inside a record class after instantiation
class MyRecord {
  getIdentifier() {
    return recordIdentifierFor(this);
  }
}
</code></pre>
<p>Whether and how to access an identifier during instantiation of a record will be left
for discussion as part of a different RFC for custom record classes.</p>
<h3 id="polymorphism--the-username-problem"><a class="header" href="#polymorphism--the-username-problem">Polymorphism &amp; &quot;The Username Problem&quot;</a></h3>
<p>A common edge case that <code>Identifiers</code> enables end users to solve is when multiple pieces
of identifying information should reference the same data.</p>
<p>For instance, when using single-table polymorphism (in which <code>ferrari</code> and <code>bmw</code> extend
<code>car</code> and share a common <code>id</code> space) then <code>ferrari:1</code> and <code>bmw:2</code> are the same vehicles
as <code>car:1</code> and <code>car:2</code>.</p>
<p>A similar problem presents for the scenario in which we know that we wish to reference a
<code>user</code> with a given <code>username</code>, but do not yet have access to the <code>id</code> for that user. In
this case, <code>user:@jackson5</code> and <code>user:abc123</code> are the same user.</p>
<p>Today in these situations many users will encounter bugs resulting from there being two 
records present in the cache instead of one. This problem can be solved with a custom 
identifier generation method that is aware of an application's polymorphic associations
or additional indexing requirements.</p>
<p>For example, to solve the username problem we might do the following:</p>
<pre><code class="language-typescript">import { setIdentifierGenerationMethod } from '@ember-data/store';

export const SECONDARY_IDENTIFIER_CACHE = new WeakMap();

export function initialize(applicationInstance) {
 let count = 0;
 const typeid_cache = {};
 const username_cache = {};

 /*
   Note: if you needed to share access to these caches elsewhere
   in the same applicationInstance, we could use a WeakMap to add
   them. Shown here for a more complete example.
 */
 SECONDARY_IDENTIFIER_CACHE.set(applicationInstance, {
   typeid: typeid_cache,
   username: username_cache
 });

 setIdentifierGenerationMethod((resource: Resource) =&gt; {
   let { type, id, lid } = resource;
   let username = (resource.type === 'user' 
     &amp;&amp; resource.attributes
     &amp;&amp; resource.attributes.username);
   let cacheKey, altCacheKey;

   if (lid) {
     // probably ensure username and id cache are populated first IRL
     return lid;
   }

   // handle the case where we do know the ID and have set the `lid` previously
   if (id) {
     cacheKey = `${type}:${id}`;

     if (lid = typeid_cache[cacheKey]) {
       return lid;
     }
   }

   // handle the cases where we have a username but we didn't know the ID yet
   if (username) {
     lid = username_cache[username];

     if (!lid) {
       lid =  `my-key-${count++}`;
       username_cache[username] = lid;
     }

     if (id) {
       typeid_cache[cacheKey] = lid;
     }
     return lid;
   }

   // handle everything else
   lid =  `my-key-${count++}`;
   typeid_cache[cacheKey] = lid;

   return lid;
 });
}

export default {
 name: 'configure-ember-data-identifiers',
 initialize
};
</code></pre>
<h4 id="handling-updates-to-alternative-cache-keys"><a class="header" href="#handling-updates-to-alternative-cache-keys">Handling Updates to Alternative Cache Keys</a></h4>
<p>Note that in our above example we treat <code>username</code> a stable, immutable alternative 
primary-key. Some APIs allow users to change the value of such &quot;unique keys&quot; (<code>email</code>
<code>phone</code> <code>username</code> being common examples).</p>
<p>If your application enables such behavior, and these updates are not handled by the
call to <code>updateRecordIdentifier</code> that occurs after a record is saved, in addition
to manually calling <code>identifierCache.updateRecordIdentifier</code> with the desired patch
you could also provide your own explicit method for doing so. An explicit method is
great for ensuring the correct context for the granularity of this change. The timing
of this update would be up to you (whether pre- or post- the mutation having been
persisted to the server)</p>
<p>Extending the example above:</p>
<pre><code class="language-ts">import { SECONDARY_IDENTIFIER_CACHE } from './initializers/configure-identifiers';

export function updateUsernameForIdentifier(
  // application instance is the result of `getOwner`
  // on something like the `store` or a `component`
  owner: Owner, 
  identifier: Identifier,
  oldUsername: string,
  newUsername: string
  ) {
   const caches = SECONDARY_IDENTIFIER_CACHE.get(applicationInstance);
   const typeid_cache = caches.typeid;
   const username_cache = caches.username;

   if (username_cache[oldUsername] !== identifier.lid) {
     throw new Error('invalid update');
   }

   // you might want to continue mapping both old an new username
   //  here we decided not to.
   delete username_cache[oldUsername];

   username_cache[newUsername] = identifier.lid;
 }
</code></pre>
<h3 id="identifier-stability"><a class="header" href="#identifier-stability">Identifier Stability</a></h3>
<p>Identifiers handed to public APIs by <code>ember-data</code> will <strong>always</strong> be <em>referentially stable</em>
Public <code>ember-data</code> APIs that <strong>expect</strong> an <code>Identifier</code> will normalize the object they 
are given into the stable <code>Identifier</code> if it is not one already. This is done to allow
for serialized identifiers and identifying information from the API to more easily be worked
with without extra normalization effort.</p>
<p>Specifically, this means that as regards this RFC, <code>identifiers</code> that are structurally the same
(meaning an object with the same <code>lid</code>) are treated as any other <code>identifier</code> regardless of
whether the object is an identical reference to the object generated by the store previously.</p>
<p>Additionally, only the objects generated by the store will have additional debug information
attached to them, as shown in the interfaces below.</p>
<pre><code class="language-typescript">const IS_IDENTIFIER = Symbol('is-identifier');

// provided for additional debuggability
const DEBUG_CLIENT_ORIGINATED = Symbol('record-originated-on-client');
const DEBUG_IDENTIFIER_BUCKET = Symbol('identifier-bucket');

export interface StableIdentifier {
  lid: string;
  [IS_IDENTIFIER]: true;
  [DEBUG_IDENTIFIER_BUCKET]: string;
}

export interface StableRecordIdentifier extends StableIdentifier {
  id: string | null;
  type: string;
  [DEBUG_CLIENT_ORIGINATED]: boolean;
}
</code></pre>
<h2 id="how-we-teach-this"><a class="header" href="#how-we-teach-this">How we teach this</a></h2>
<p>Largely this is an internal feature, although one that power users will sometimes need
access to. Additional guides should be created showing how identifiers may be used to
solve common edge cases unique to given users. We have attempted to go into depth here
with examples and documentation about the capabilities provided to make creating these
additional resources as easy as possible.</p>
<p>Existing APIs that accept or provide <code>id</code> and <code>type</code> information will continue to do so
unchanged.</p>
<h2 id="drawbacks"><a class="header" href="#drawbacks">Drawbacks</a></h2>
<ul>
<li>None, the performance characteristics of the setup here described may seem worse on
allocation (object vs string identifier) but in reality they significantly improve our
ability to reduce allocations, duplicate logic, and branching code paths throughout the
library.</li>
</ul>
<h2 id="alternatives"><a class="header" href="#alternatives">Alternatives</a></h2>
<p>A lengthy amount of discussion was had revolving around whether <code>Identifiers</code> shouldn't be
a simple <code>string</code> (e.g. just the <code>lid</code> portion).</p>
<p>The arguments for doing so revolve around <code>string</code> being referentially stable automatically,
and that we do not require an <code>object reference</code> for being able to use identifiers as keys in
<code>WeakMaps</code> both because <code>lid</code> is stable and because <code>ember-data</code> has need of controlling most
of the object lifecycle.</p>
<p>However, continuing to use an object wrapper, especially a stable object wrapper, comes with
a multitude of benefits, including:</p>
<ul>
<li><strong>debugging:</strong> enhanced debugging by associating additional information with the
identifier in development builds</li>
<li><strong>debugging:</strong> enhanced debugging by users being able to see type and id at a 
glance when inspecting state.</li>
<li><strong>bug prevention:</strong> enforcement of the use of the identifier generation process 
(to ensure lookup tables are properly populated)</li>
<li><strong>debugging:</strong> ability to tell at a glance that an identifier was properly processed</li>
<li><strong>ergonomics:</strong> closer alignment to <code>jsonapi</code> that makes it true that all <code>RecordIdentifiers</code>
are also <code>ResourceIdentifierObjects</code></li>
<li><strong>ergonomics:</strong> We can provide better <code>typescript</code> support for an object interface than a <code>string</code>
given that any <code>string</code> would fit the <code>lid</code> interface but only correctly shaped objects (which includes
the <code>Symbol</code> for <code>identifier</code>) would fit the correct object interface.</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="0398-RouteInfo-Metadata.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="0408-decorators.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="0398-RouteInfo-Metadata.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="0408-decorators.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
